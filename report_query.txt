SELECT 
       drug_name,
       SUM(A) disposal_quantity,
       SUM(B) undisposed_quantity
FROM 
(
       select drug_name, 
              CASE 
					WHEN disposal_flag = 'Y' THEN disposal_quantity ELSE 0 END as A,
			  CASE
					WHEN disposal_flag = 'Y' THEN quantity_of_drug-quantity_of_sample-disposal_quantity 
					ELSE quantity_of_drug-coalesce(quantity_of_sample, 0) END as B
       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id
) t
GROUP BY drug_name

-------------------------------------------------------------

SELECT 
       drug_name,
       X1,X2,X3
FROM 
(
       select drug_name, 
			  CASE 		WHEN u1.unit_degree = 2 THEN quantity_of_drug/1000 
					WHEN u1.unit_degree = 1 THEN quantity_of_drug/1000000
					WHEN u1.unit_degree = 3 THEN quantity_of_drug
					WHEN u1.unit_degree = 0 THEN quantity_of_drug
					END AS X1,

			  CASE 		WHEN u2.unit_degree = 2 THEN disposal_quantity/1000
					WHEN u2.unit_degree = 1 THEN disposal_quantity/1000000
					WHEN u2.unit_degree = 3 THEN disposal_quantity
					WHEN u2.unit_degree = 0 THEN disposal_quantity
					END AS X2,

			  CASE 		WHEN u3.unit_degree = 2 THEN quantity_of_sample/1000
					WHEN u3.unit_degree = 1 THEN quantity_of_sample/1000000
					WHEN u3.unit_degree = 3 THEN quantity_of_sample
					WHEN u3.unit_degree = 0 THEN quantity_of_sample
					END AS X3,

			
              		  CASE 		WHEN disposal_flag = 'Y' THEN disposal_quantity ELSE 0 END as A,
              		  
			  CASE		WHEN disposal_flag = 'Y' THEN quantity_of_drug-quantity_of_sample-disposal_quantity 
					ELSE quantity_of_drug-coalesce(quantity_of_sample, 0) END as B
					
       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id 
       inner join units as u1 on seizures.seizure_quantity_weighing_unit_id=u1.unit_id 
       left join units as u2  on seizures.disposal_quantity_weighing_unit_id=u2.unit_id 
       left join units as u3  on seizures.sample_quantity_weighing_unit_id=u3.unit_id 
) t


----------------------------------------------------------------------TOTAL DRUG WISE--------------------------------------------------



SELECT 
drug_name,SUM(A) disposal_quantity,SUM(B) undisposed_quantity,quantity_unit_name as unit_name
FROM
(
	select drug_name, quantity_unit_name,
              		  CASE 
					WHEN disposal_flag = 'Y' THEN disposal ELSE 0 END as A,
			  CASE
					WHEN disposal_flag = 'Y' THEN seizure-sample-disposal 
					ELSE seizure-coalesce(sample, 0) END as B
	FROM
	(
		SELECT 
		       drug_name, disposal_flag,seizure,disposal,sample,quantity_unit_name
			FROM 
			(
			       select drug_name, disposal_flag, 
						  CASE 		WHEN u1.unit_degree = 2 THEN quantity_of_drug/1000 
								WHEN u1.unit_degree = 1 THEN quantity_of_drug/1000000
								WHEN u1.unit_degree = 3 THEN quantity_of_drug
								WHEN u1.unit_degree = 0 THEN quantity_of_drug
								END AS seizure,

						  CASE          WHEN u1.unit_name ilike '%m'  THEN 'KG'
								WHEN u1.unit_name ilike '%e' OR u1.unit_name ilike '%l'  THEN 'KL'
								ELSE u1.unit_name
								END AS quantity_unit_name,
								

						  CASE 		WHEN u2.unit_degree = 2 THEN disposal_quantity/1000
								WHEN u2.unit_degree = 1 THEN disposal_quantity/1000000
								WHEN u2.unit_degree = 3 THEN disposal_quantity
								WHEN u2.unit_degree = 0 THEN disposal_quantity
								END AS disposal,
						  

						  CASE 		WHEN u3.unit_degree = 2 THEN quantity_of_sample/1000
								WHEN u3.unit_degree = 1 THEN quantity_of_sample/1000000
								WHEN u3.unit_degree = 3 THEN quantity_of_sample
								WHEN u3.unit_degree = 0 THEN quantity_of_sample
								END AS sample

						 
								
			       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id 
			       inner join units as u1 on seizures.seizure_quantity_weighing_unit_id=u1.unit_id 
			       left join units as u2  on seizures.disposal_quantity_weighing_unit_id=u2.unit_id 
			       left join units as u3  on seizures.sample_quantity_weighing_unit_id=u3.unit_id 
			) a
	)b
)c GROUP BY drug_name,quantity_unit_name 


------------------------------------------------------DRUG WISE--DISTRICT WISE------------------------------------



SELECT 
drug_name,SUM(A) disposal_quantity,SUM(B) undisposed_quantity,quantity_unit_name as unit_name
FROM
(
	select drug_name, quantity_unit_name,
              		  CASE 
					WHEN disposal_flag = 'Y' THEN disposal ELSE 0 END as A,
			  CASE
					WHEN disposal_flag = 'Y' THEN seizure-sample-disposal 
					ELSE seizure-coalesce(sample, 0) END as B
	FROM
	(
		SELECT 
		       drug_name, disposal_flag,seizure,disposal,sample,quantity_unit_name
			FROM 
			(
			       select drug_name, disposal_flag, 
						  CASE 		WHEN u1.unit_degree = 2 THEN quantity_of_drug/1000 
								WHEN u1.unit_degree = 1 THEN quantity_of_drug/1000000
								WHEN u1.unit_degree = 3 THEN quantity_of_drug
								WHEN u1.unit_degree = 0 THEN quantity_of_drug
								END AS seizure,

						  CASE          WHEN u1.unit_name ilike '%m'  THEN 'KG'
								WHEN u1.unit_name ilike '%e' OR u1.unit_name ilike '%l'  THEN 'KL'
								ELSE u1.unit_name
								END AS quantity_unit_name,
								

						  CASE 		WHEN u2.unit_degree = 2 THEN disposal_quantity/1000
								WHEN u2.unit_degree = 1 THEN disposal_quantity/1000000
								WHEN u2.unit_degree = 3 THEN disposal_quantity
								WHEN u2.unit_degree = 0 THEN disposal_quantity
								END AS disposal,
						  

						  CASE 		WHEN u3.unit_degree = 2 THEN quantity_of_sample/1000
								WHEN u3.unit_degree = 1 THEN quantity_of_sample/1000000
								WHEN u3.unit_degree = 3 THEN quantity_of_sample
								WHEN u3.unit_degree = 0 THEN quantity_of_sample
								END AS sample

						 
								
			       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id 
			       inner join units as u1 on seizures.seizure_quantity_weighing_unit_id=u1.unit_id 
			       left join units as u2  on seizures.disposal_quantity_weighing_unit_id=u2.unit_id 
			       left join units as u3  on seizures.sample_quantity_weighing_unit_id=u3.unit_id 
			       where district_id=1
			) a
	)b
)c GROUP BY drug_name,quantity_unit_name 



-------------------------------------------------court wise drug wise--------------------------------------------------------------------



SELECT 
drug_name,SUM(A) disposal_quantity,SUM(B) undisposed_quantity,quantity_unit_name as unit_name
FROM
(
	select drug_name, quantity_unit_name,
              		  CASE 
					WHEN disposal_flag = 'Y' THEN disposal ELSE 0 END as A,
			  CASE
					WHEN disposal_flag = 'Y' THEN seizure-sample-disposal 
					ELSE seizure-coalesce(sample, 0) END as B
	FROM
	(
		SELECT 
		       drug_name, disposal_flag,seizure,disposal,sample,quantity_unit_name
			FROM 
			(
			       select drug_name, disposal_flag, 
						  CASE 		WHEN u1.unit_degree = 2 THEN quantity_of_drug/1000 
								WHEN u1.unit_degree = 1 THEN quantity_of_drug/1000000
								WHEN u1.unit_degree = 3 THEN quantity_of_drug
								WHEN u1.unit_degree = 0 THEN quantity_of_drug
								END AS seizure,

						  CASE          WHEN u1.unit_name ilike '%m'  THEN 'KG'
								WHEN u1.unit_name ilike '%e' OR u1.unit_name ilike '%l'  THEN 'KL'
								ELSE u1.unit_name
								END AS quantity_unit_name,
								

						  CASE 		WHEN u2.unit_degree = 2 THEN disposal_quantity/1000
								WHEN u2.unit_degree = 1 THEN disposal_quantity/1000000
								WHEN u2.unit_degree = 3 THEN disposal_quantity
								WHEN u2.unit_degree = 0 THEN disposal_quantity
								END AS disposal,
						  

						  CASE 		WHEN u3.unit_degree = 2 THEN quantity_of_sample/1000
								WHEN u3.unit_degree = 1 THEN quantity_of_sample/1000000
								WHEN u3.unit_degree = 3 THEN quantity_of_sample
								WHEN u3.unit_degree = 0 THEN quantity_of_sample
								END AS sample

						 
								
			       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id 
			       inner join units as u1 on seizures.seizure_quantity_weighing_unit_id=u1.unit_id 
			       left join units as u2  on seizures.disposal_quantity_weighing_unit_id=u2.unit_id 
			       left join units as u3  on seizures.sample_quantity_weighing_unit_id=u3.unit_id 
			       where certification_court_id=1
			) a
	)b
)c GROUP BY drug_name,quantity_unit_name 

-------------------------------------------------------------------------------stakeholder wise------------------------------------



SELECT 
drug_name,SUM(A) disposal_quantity,SUM(B) undisposed_quantity,quantity_unit_name as unit_name
FROM
(
	select drug_name, quantity_unit_name,
              		  CASE 
					WHEN disposal_flag = 'Y' THEN disposal ELSE 0 END as A,
			  CASE
					WHEN disposal_flag = 'Y' THEN seizure-sample-disposal 
					ELSE seizure-coalesce(sample, 0) END as B
	FROM
	(
		SELECT 
		       drug_name, disposal_flag,seizure,disposal,sample,quantity_unit_name
			FROM 
			(
			       select drug_name, disposal_flag, 
						  CASE 		WHEN u1.unit_degree = 2 THEN quantity_of_drug/1000 
								WHEN u1.unit_degree = 1 THEN quantity_of_drug/1000000
								WHEN u1.unit_degree = 3 THEN quantity_of_drug
								WHEN u1.unit_degree = 0 THEN quantity_of_drug
								END AS seizure,

						  CASE          WHEN u1.unit_name ilike '%m'  THEN 'KG'
								WHEN u1.unit_name ilike '%e' OR u1.unit_name ilike '%l'  THEN 'KL'
								ELSE u1.unit_name
								END AS quantity_unit_name,
								

						  CASE 		WHEN u2.unit_degree = 2 THEN disposal_quantity/1000
								WHEN u2.unit_degree = 1 THEN disposal_quantity/1000000
								WHEN u2.unit_degree = 3 THEN disposal_quantity
								WHEN u2.unit_degree = 0 THEN disposal_quantity
								END AS disposal,
						  

						  CASE 		WHEN u3.unit_degree = 2 THEN quantity_of_sample/1000
								WHEN u3.unit_degree = 1 THEN quantity_of_sample/1000000
								WHEN u3.unit_degree = 3 THEN quantity_of_sample
								WHEN u3.unit_degree = 0 THEN quantity_of_sample
								END AS sample

						 
								
			       from  seizures inner join narcotics on seizures.drug_id = narcotics.drug_id 
			       inner join units as u1 on seizures.seizure_quantity_weighing_unit_id=u1.unit_id 
			       left join units as u2  on seizures.disposal_quantity_weighing_unit_id=u2.unit_id 
			       left join units as u3  on seizures.sample_quantity_weighing_unit_id=u3.unit_id 
			       where stakeholder_id=1
			) a
	)b
)c GROUP BY drug_name,quantity_unit_name 

---------------------------------------------------------

select pg_size_pretty(pg_database_size('ndps'))



-----------------------------------------------------------

select pg_size_pretty(pg_total_relation_size('seizures'))